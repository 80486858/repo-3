before:
  hooks:
    - make manifest
builds:
  -
    id: capp
    env:
      - CGO_ENABLED=0
    binary: manager
    goos:
      - darwin
      - linux
    goarch:
      - amd64
      - arm64
release:
  extra_files:
    - glob: "./out/release/infrastructure-packet/{{ .Tag }}/*"
dockers:
  - image_templates:
      - "packethost/cluster-api-provider-packet:latest-arm64"
      - "packethost/cluster-api-provider-packet:{{ .Tag }}-arm64"
    binaries:
      - manager
    builds:
      - capp
    dockerfile: Dockerfile.goreleaser
    goos: linux
    goarch: arm64
    # The idea here is to add a post hook that will use the manifest tool to
    # merge all the images and push them properly
    skip_push: true
  - image_templates:
      - "packethost/cluster-api-provider-packet:latest-amd64"
      - "packethost/cluster-api-provider-packet:{{ .Tag }}-amd64"
    dockerfile: Dockerfile.goreleaser
    binaries:
      - manager
    builds:
      - capp
    goos: linux
    goarch: amd64
    # The idea here is to add a post hook that will use the manifest tool to
    # merge all the images and push them properly
    skip_push: true
archives:
- replacements:
    darwin: Darwin
    linux: Linux
    386: i386
    amd64: x86_64
checksum:
  name_template: 'checksums.txt'
snapshot:
  name_template: "{{ .Tag }}-next"
changelog:
  sort: asc
  filters:
    exclude:
    - '^docs:'
    - '^test:'
